<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CometChat Admin Dashboard</title>
    <style>
        /* CSS STYLES */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        
        /* LOGIN SCREEN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; }
        #login-screen input { padding: 10px; font-size: 16px; border-radius: 5px; border: none; margin-bottom: 10px; width: 250px; }
        #login-screen button { padding: 10px 20px; font-size: 16px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; }
        
        /* SIDEBAR */
        #sidebar { width: 250px; background: #34495e; color: white; display: flex; flex-direction: column; padding: 20px; }
        #sidebar h2 { margin-top: 0; font-size: 20px; border-bottom: 1px solid #46627f; padding-bottom: 20px; }
        .nav-btn { background: none; border: none; color: #bdc3c7; text-align: left; padding: 15px; font-size: 16px; cursor: pointer; transition: 0.3s; border-radius: 5px; margin-bottom: 5px; }
        .nav-btn:hover, .nav-btn.active { background: #2c3e50; color: white; }
        
        /* MAIN CONTENT */
        #main-content { flex: 1; padding: 30px; overflow-y: auto; display: none; } /* Hidden by default until login */
        
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        
        /* CARDS & TABLES */
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h3 { margin-top: 0; color: #2c3e50; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 10px; }
        button.action-btn { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button.delete-btn { background: #e74c3c; padding: 5px 10px; color: white; border: none; border-radius: 3px; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8f9fa; text-align: left; padding: 12px; border-bottom: 2px solid #eee; color: #7f8c8d; }
        td { padding: 12px; border-bottom: 1px solid #eee; color: #2c3e50; }
        
        /* LOGS AREA */
        .log-entry { padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        .log-entry:last-child { border-bottom: none; }
        .log-meta { color: #95a5a6; font-size: 12px; margin-bottom: 3px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-screen">
        <h2>ðŸ”’ Admin Access</h2>
        <input type="password" id="passwordInput" placeholder="Enter Dashboard Password">
        <button onclick="attemptLogin()">Unlock</button>
        <p id="loginError" style="color: #e74c3c; display: none;">Incorrect Password</p>
    </div>

    <div id="sidebar" style="display: none;">
        <h2>âš¡ CometChat Admin</h2>
        <button class="nav-btn active" onclick="showSection('users')">ðŸ‘¥ User Management</button>
        <button class="nav-btn" onclick="showSection('groups')">ðŸ“¢ Group Management</button>
        <button class="nav-btn" onclick="showSection('chatlogs')">ðŸ’¬ Chat Logs</button>
        <button class="nav-btn" onclick="showSection('calllogs')">ðŸ“¹ Voice & Video Logs</button>
        <div style="margin-top: auto; font-size: 12px; color: #7f8c8d;">App ID: 1669...d328</div>
    </div>

    <div id="main-content">
        
        <div id="users" class="section active">
            <div class="card">
                <h3>Create New User</h3>
                <input type="text" id="newUid" placeholder="UID (e.g. ross01)">
                <input type="text" id="newName" placeholder="Display Name">
                <button class="action-btn" onclick="createUser()">Add User</button>
            </div>
            <div class="card">
                <h3>User List</h3>
                <button class="action-btn" onclick="fetchUsers()">ðŸ”„ Refresh List</button>
                <table id="userTable">
                    <thead><tr><th>Avatar</th><th>UID</th><th>Name</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="groups" class="section">
            <div class="card">
                <h3>Create New Group</h3>
                <input type="text" id="newGuid" placeholder="GUID (e.g. marketing)">
                <input type="text" id="newGroupName" placeholder="Group Name">
                <select id="groupType"><option value="public">Public</option><option value="private">Private</option></select>
                <button class="action-btn" onclick="createGroup()">Create Group</button>
            </div>
            <div class="card">
                <h3>Group List</h3>
                <button class="action-btn" onclick="fetchGroups()">ðŸ”„ Refresh List</button>
                <table id="groupTable">
                    <thead><tr><th>GUID</th><th>Name</th><th>Type</th><th>Members</th><th>Actions</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="chatlogs" class="section">
            <div class="card">
                <h3>View Message History</h3>
                <p>Enter a UID (User) or GUID (Group) to see their messages.</p>
                <input type="text" id="logId" placeholder="UID or GUID">
                <select id="logType">
                    <option value="users">User (1-on-1)</option>
                    <option value="groups">Group</option>
                </select>
                <button class="action-btn" onclick="fetchChatLogs()">Fetch Logs</button>
            </div>
            <div class="card">
                <h3>Results</h3>
                <div id="chatLogResults" style="max-height: 400px; overflow-y: auto;">
                    <div style="color: #999; text-align: center; padding: 20px;">No logs loaded yet.</div>
                </div>
            </div>
        </div>

        <div id="calllogs" class="section">
            <div class="card">
                <h3>Call History</h3>
                <p>View recent voice and video calls.</p>
                <button class="action-btn" onclick="fetchCallLogs()">Fetch Call Logs</button>
            </div>
            <div class="card">
                <table id="callTable">
                    <thead><tr><th>Call ID</th><th>Initiator</th><th>Receiver</th><th>Type</th><th>Status</th><th>Time</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // CONFIGURATION
        const APP_ID = "16690658bf8acd328";
        const REGION = "eu";
        const REST_API_KEY = "8031bed1942057c0bb44a1a0710ddb3875079025"; // <--- PASTE YOUR API KEY HERE
        
        // DASHBOARD PASSWORD
        const DASHBOARD_PASSWORD = "admin"; // <--- CHANGE THIS PASSWORD

        const HEADERS = {
            "apiKey": REST_API_KEY,
            "Content-Type": "application/json",
            "Accept": "application/json"
        };
        const BASE_URL = `https://${APP_ID}.api-${REGION}.cometchat.io/v3`;

        // --- AUTHENTICATION ---
        function attemptLogin() {
            const input = document.getElementById("passwordInput").value;
            if(input === DASHBOARD_PASSWORD) {
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("sidebar").style.display = "flex";
                document.getElementById("main-content").style.display = "block";
                fetchUsers(); // Auto load users
            } else {
                document.getElementById("loginError").style.display = "block";
            }
        }

        // --- NAVIGATION ---
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- 1. USER MANAGEMENT ---
        async function fetchUsers() {
            try {
                const res = await fetch(`${BASE_URL}/users`, { headers: HEADERS });
                const data = await res.json();
                const tbody = document.querySelector("#userTable tbody");
                tbody.innerHTML = "";
                data.data.forEach(u => {
                    tbody.innerHTML += `
                        <tr>
                            <td><img src="${u.avatar || 'https://via.placeholder.com/30'}" width="30" style="border-radius:50%"></td>
                            <td>${u.uid}</td>
                            <td>${u.name}</td>
                            <td>${u.status || 'offline'}</td>
                            <td><button class="delete-btn" onclick="deleteUser('${u.uid}')">Delete</button></td>
                        </tr>`;
                });
            } catch (e) { alert("Error fetching users: " + e.message); }
        }

        async function createUser() {
            const uid = document.getElementById("newUid").value;
            const name = document.getElementById("newName").value;
            if(!uid || !name) return alert("Please fill in fields");

            await fetch(`${BASE_URL}/users`, {
                method: "POST",
                headers: HEADERS,
                body: JSON.stringify({ uid, name })
            });
            alert("User Created");
            fetchUsers();
            document.getElementById("newUid").value = "";
        }

        async function deleteUser(uid) {
            if(!confirm("Delete user " + uid + "?")) return;
            await fetch(`${BASE_URL}/users/${uid}`, { method: "DELETE", headers: HEADERS });
            fetchUsers();
        }

        // --- 2. GROUP MANAGEMENT ---
        async function fetchGroups() {
            const res = await fetch(`${BASE_URL}/groups`, { headers: HEADERS });
            const data = await res.json();
            const tbody = document.querySelector("#groupTable tbody");
            tbody.innerHTML = "";
            data.data.forEach(g => {
                tbody.innerHTML += `
                    <tr>
                        <td>${g.guid}</td>
                        <td>${g.name}</td>
                        <td>${g.type}</td>
                        <td>${g.membersCount}</td>
                        <td><button class="delete-btn" onclick="deleteGroup('${g.guid}')">Delete</button></td>
                    </tr>`;
            });
        }

        async function createGroup() {
            const guid = document.getElementById("newGuid").value;
            const name = document.getElementById("newGroupName").value;
            const type = document.getElementById("groupType").value;
            
            await fetch(`${BASE_URL}/groups`, {
                method: "POST",
                headers: HEADERS,
                body: JSON.stringify({ guid, name, type })
            });
            alert("Group Created");
            fetchGroups();
        }

        async function deleteGroup(guid) {
            if(!confirm("Delete group " + guid + "?")) return;
            await fetch(`${BASE_URL}/groups/${guid}`, { method: "DELETE", headers: HEADERS });
            fetchGroups();
        }

        // --- 3. CHAT LOGS ---
        async function fetchChatLogs() {
            const id = document.getElementById("logId").value;
            const type = document.getElementById("logType").value; // users or groups
            if(!id) return alert("Enter a UID or GUID");

            const container = document.getElementById("chatLogResults");
            container.innerHTML = "Loading...";

            try {
                // Fetch messages for a specific user or group
                const res = await fetch(`${BASE_URL}/${type}/${id}/messages`, { headers: HEADERS });
                const data = await res.json();
                
                container.innerHTML = "";
                if(!data.data || data.data.length === 0) {
                    container.innerHTML = "<p>No messages found.</p>";
                    return;
                }

                data.data.forEach(msg => {
                    let content = msg.data.text || "[Media/Custom Message]";
                    let sender = msg.sender ? msg.sender.name : "System";
                    let time = new Date(msg.sentAt * 1000).toLocaleString();
                    
                    container.innerHTML += `
                        <div class="log-entry">
                            <div class="log-meta"><strong>${sender}</strong> â€¢ ${time}</div>
                            <div>${content}</div>
                        </div>`;
                });
            } catch(e) { container.innerHTML = "Error: " + e.message; }
        }

        // --- 4. CALL LOGS ---
        async function fetchCallLogs() {
            // Note: Not all plans support direct call listing via API, but we try the standard endpoint
            try {
                // We fetch messages with category='call' to find call logs if direct endpoint fails
                // But let's try a direct call report mock or the messages filter first
                // Strategy: Fetch messages from the App (not easy without paid extension), 
                // SO we will simulate by fetching recent messages that are calls.
                // NOTE: CometChat API v3 doesn't have a simple "GET ALL CALLS" for the app without extensions.
                // We will try to fetch the logged in user's calls or just alert the user.
                
                alert("Note: To view global call logs, you typically need the CometChat Reports Extension enabled. Checking basic logs...");
                
                // For this demo, we'll try to fetch calls via the 'messages' endpoint filtering for category=call if possible, 
                // but strictly speaking, you should check the official dashboard for global call reports.
                
                // Placeholder for visual layout
                const tbody = document.querySelector("#callTable tbody");
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center">Global Call Logs require the "Reports" extension. <br> Please check the official dashboard for detailed Call analytics.</td></tr>`;
                
            } catch(e) { console.error(e); }
        }
    </script>
</body>
</html>