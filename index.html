<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CometChat User Manager</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; cursor: pointer; border-radius: 4px; border: none; background: #007bff; color: white; }
        button.delete { background: #dc3545; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

    <h2>User Management Console</h2>

    <div class="card">
        <h3>Create New User</h3>
        <input type="text" id="newUid" placeholder="UID (e.g. john123)">
        <input type="text" id="newName" placeholder="Name (e.g. John Doe)">
        <button onclick="createUser()">Add User</button>
    </div>

    <div class="card">
        <h3>Current Users</h3>
        <button onclick="fetchUsers()">Refresh List</button>
        <table id="userTable">
            <thead>
                <tr>
                    <th>UID</th>
                    <th>Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <script>
        const appId = "16690658bf8acd328";
        const region = "eu";
        const apiKey = "8031bed1942057c0bb44a1a0710ddb3875079025"; // PASTE REST API KEY HERE

        const headers = {
            "apiKey": apiKey,
            "Content-Type": "application/json",
            "Accept": "application/json"
        };

        // 1. FETCH USERS
        async function fetchUsers() {
            const response = await fetch(`https://${appId}.api-${region}.cometchat.io/v3/users`, { headers });
            const data = await response.json();
            const tbody = document.querySelector("#userTable tbody");
            tbody.innerHTML = "";
            
            data.data.forEach(user => {
                tbody.innerHTML += `
                    <tr>
                        <td>${user.uid}</td>
                        <td>${user.name}</td>
                        <td><button class="delete" onclick="deleteUser('${user.uid}')">Delete</button></td>
                    </tr>
                `;
            });
        }

        // 2. CREATE USER
        async function createUser() {
            const uid = document.getElementById("newUid").value;
            const name = document.getElementById("newName").value;
            
            const response = await fetch(`https://${appId}.api-${region}.cometchat.io/v3/users`, {
                method: "POST",
                headers: headers,
                body: JSON.stringify({ uid, name })
            });

            if (response.ok) {
                alert("User Created!");
                fetchUsers();
            } else {
                alert("Error creating user.");
            }
        }

        // 3. DELETE USER
        async function deleteUser(uid) {
            if (!confirm(`Are you sure you want to delete ${uid}?`)) return;

            const response = await fetch(`https://${appId}.api-${region}.cometchat.io/v3/users/${uid}`, {
                method: "DELETE",
                headers: headers
            });

            if (response.ok) {
                fetchUsers();
            } else {
                alert("Error deleting user.");
            }
        }

        // Load users on start
        fetchUsers();
    </script>
</body>
</html>